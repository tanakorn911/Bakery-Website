{% extends "layout.html" %}

{% block title %}ชำระเงิน - Sweet Dreams Bakery{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/checkout.css') }}">
{% endblock %}

{% block content %}
<div class="container py-5 checkout-page">
    <h2>ชำระเงิน</h2>

    <form method="POST" id="checkout-form">
        <!-- ชื่อ / เบอร์โทร -->
        <div class="mb-3">
            <label>ชื่อ-นามสกุล *</label>
            <input type="text" name="customer_name" class="form-control" required value="{{ session.get('full_name','') }}">
        </div>
        <div class="mb-3">
            <label>เบอร์โทรศัพท์ *</label>
            <input type="tel" name="customer_phone" class="form-control" required>
        </div>

        <!-- วิธีการรับสินค้า -->
        <div class="mb-3">
            <label>วิธีการรับสินค้า *</label>
            <select class="form-select" name="delivery_method" required>
                <option value="delivery">จัดส่งถึงบ้าน</option>
                <option value="pickup">รับที่ร้าน</option>
            </select>
        </div>

        <!-- ที่อยู่ (select จาก addresses) -->
        <div class="mb-3" id="address-section">
            <label>ที่อยู่จัดส่ง *</label>
            <select class="form-select" name="customer_address">
                {% for addr in addresses %}
                <option value="{{ addr.id }}">{{ addr.full_address }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Payment Method -->
        <div class="mb-3">
            <label>วิธีชำระเงิน *</label>
            <select class="form-select" name="payment_method" required>
                <option value="cod">เก็บเงินปลายทาง (COD)</option>
                <option value="promptpay">PromptPay</option>
            </select>
        </div>

        <!-- หมายเหตุ -->
        <div class="mb-3">
            <label>หมายเหตุเพิ่มเติม</label>
            <textarea name="notes" class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">สั่งซื้อเลย</button>
    </form>
</div>

<script>
    // ซ่อนที่อยู่ถ้าเลือก pickup
    const deliverySelect = document.querySelector('select[name="delivery_method"]');
    const addressSection = document.getElementById('address-section');

    deliverySelect.addEventListener('change', function() {
        if (this.value === 'pickup') {
            addressSection.style.display = 'none';
            addressSection.querySelector('select').required = false;
        } else {
            addressSection.style.display = 'block';
            addressSection.querySelector('select').required = true;
        }
    });
</script>
{% endblock %}
