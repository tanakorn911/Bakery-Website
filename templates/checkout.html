{% extends "layout.html" %}

{% block title %}ชำระเงิน - Sweet Dreams Bakery{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
{% endblock %}

{% block content %}
<script>
    document.body.classList.add('checkout-bg');
</script>
<div class="container py-5 animate-fade-in-up">
    <div class="checkout-card">
        <div class="checkout-title mb-4">
            <i class="fas fa-credit-card"></i>
            ชำระเงิน
        </div>
        <form method="POST" id="checkout-form" class="checkout-form">
            <div class="mb-3">
                <label class="form-label">ชื่อ-นามสกุล *</label>
                <input type="text" name="customer_name" class="form-control" required value="{{ session.get('full_name','') }}">
            </div>
            <div class="mb-3">
                <label class="form-label">เบอร์โทรศัพท์ *</label>
                <input type="tel" name="customer_phone" class="form-control" required pattern="[0-9]{9,10}" maxlength="10" placeholder="08xxxxxxxx">
            </div>
            <div class="mb-3">
                <label class="form-label">วิธีการรับสินค้า *</label>
                <select class="form-select" name="delivery_method" required>
                    <option value="delivery">จัดส่งถึงบ้าน</option>
                    <option value="pickup">รับที่ร้าน</option>
                </select>
            </div>
            <div class="mb-3" id="address-section">
                <label class="form-label">ที่อยู่จัดส่ง *</label>
                <select class="form-select" name="customer_address">
                    {% for addr in addresses %}
                    <option value="{{ addr.id }}">{{ addr.full_address }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">วิธีชำระเงิน *</label>
                <select class="form-select" name="payment_method" required>
                    <option value="cod">เก็บเงินปลายทาง (COD)</option>
                    <option value="promptpay">PromptPay</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">หมายเหตุเพิ่มเติม</label>
                <textarea name="notes" class="form-control" placeholder="เช่น ต้องการช้อนส้อมเพิ่ม, เวลาส่ง ฯลฯ"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">สั่งซื้อเลย</button>
        </form>
    </div>
</div>
<script>
    // ซ่อนที่อยู่ถ้าเลือก pickup
    const deliverySelect = document.querySelector('select[name="delivery_method"]');
    const addressSection = document.getElementById('address-section');
    deliverySelect.addEventListener('change', function() {
        if (this.value === 'pickup') {
            addressSection.style.display = 'none';
            addressSection.querySelector('select').required = false;
        } else {
            addressSection.style.display = 'block';
            addressSection.querySelector('select').required = true;
        }
    });
</script>
{% endblock %}
